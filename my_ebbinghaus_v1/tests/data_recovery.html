<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®æ¢å¤å·¥å…·</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .recovery-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .recovery-result { margin: 10px 0; padding: 10px; }
        .pass { background-color: #d4edda; color: #155724; }
        .fail { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button { padding: 8px 16px; margin: 5px; }
        textarea { width: 100%; height: 200px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>æ•°æ®æ¢å¤å·¥å…·</h1>
    <p>å¦‚æœæ‚¨çš„çŸ¥è¯†ç‚¹æ•°æ®ä¸¢å¤±äº†ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå·¥å…·æ¥æ¢å¤æˆ–æ£€æŸ¥æ•°æ®çŠ¶æ€ã€‚</p>
    
    <div class="recovery-section">
        <h2>1. æ£€æŸ¥å½“å‰æ•°æ®çŠ¶æ€</h2>
        <button onclick="checkCurrentData()">æ£€æŸ¥å½“å‰æ•°æ®</button>
        <div id="current-data-results"></div>
    </div>
    
    <div class="recovery-section">
        <h2>2. æ£€æŸ¥localStorage</h2>
        <button onclick="checkLocalStorage()">æ£€æŸ¥localStorage</button>
        <div id="localstorage-results"></div>
    </div>
    
    <div class="recovery-section">
        <h2>3. æ•°æ®å¤‡ä»½</h2>
        <button onclick="backupData()">å¤‡ä»½å½“å‰æ•°æ®</button>
        <div id="backup-results"></div>
    </div>
    
    <div class="recovery-section">
        <h2>4. æ•°æ®æ¢å¤</h2>
        <p>å¦‚æœæ‚¨æœ‰å¤‡ä»½æ•°æ®ï¼Œå¯ä»¥ç²˜è´´åˆ°è¿™é‡Œæ¢å¤ï¼š</p>
        <textarea id="restore-data" placeholder="ç²˜è´´å¤‡ä»½çš„JSONæ•°æ® here..."></textarea>
        <button onclick="restoreData()">æ¢å¤æ•°æ®</button>
        <div id="restore-results"></div>
    </div>
    
    <div class="recovery-section">
        <h2>5. æ¸…ç†æ•°æ®</h2>
        <button onclick="clearAllData()">æ¸…ç†æ‰€æœ‰æ•°æ®</button>
        <div id="clear-results"></div>
    </div>
    
    <script src="../src/js/storage.js"></script>
    <script>
        function checkCurrentData() {
            const results = document.getElementById('current-data-results');
            results.innerHTML = '<h3>å½“å‰æ•°æ®çŠ¶æ€ï¼š</h3>';
            
            try {
                const points = getAllKnowledgePoints();
                results.innerHTML += `<div class="recovery-result info">ğŸ“Š çŸ¥è¯†ç‚¹æ•°é‡ï¼š${points.length}</div>`;
                
                if (points.length > 0) {
                    results.innerHTML += '<div class="recovery-result pass">âœ… æ•°æ®å­˜åœ¨</div>';
                    points.forEach((point, index) => {
                        results.innerHTML += `
                            <div class="recovery-result info">
                                ${index + 1}. ${point.title} (${point.masteryLevel}) - ID: ${point.id}
                            </div>
                        `;
                    });
                } else {
                    results.innerHTML += '<div class="recovery-result fail">âŒ æ²¡æœ‰æ‰¾åˆ°çŸ¥è¯†ç‚¹æ•°æ®</div>';
                }
                
            } catch (error) {
                results.innerHTML += `<div class="recovery-result fail">âŒ æ£€æŸ¥å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function checkLocalStorage() {
            const results = document.getElementById('localstorage-results');
            results.innerHTML = '<h3>localStorageçŠ¶æ€ï¼š</h3>';
            
            try {
                const storageKey = 'my_ebbinghaus_knowledge_points';
                const data = localStorage.getItem(storageKey);
                
                if (data) {
                    results.innerHTML += '<div class="recovery-result pass">âœ… localStorageä¸­æœ‰æ•°æ®</div>';
                    results.innerHTML += `<div class="recovery-result info">æ•°æ®é•¿åº¦ï¼š${data.length} å­—ç¬¦</div>`;
                    
                    try {
                        const parsed = JSON.parse(data);
                        results.innerHTML += `<div class="recovery-result info">è§£ææˆåŠŸï¼ŒåŒ…å« ${parsed.length} ä¸ªçŸ¥è¯†ç‚¹</div>`;
                    } catch (parseError) {
                        results.innerHTML += `<div class="recovery-result fail">âŒ æ•°æ®æ ¼å¼é”™è¯¯ï¼š${parseError.message}</div>`;
                    }
                } else {
                    results.innerHTML += '<div class="recovery-result fail">âŒ localStorageä¸­æ²¡æœ‰æ•°æ®</div>';
                }
                
                // æ˜¾ç¤ºåŸå§‹æ•°æ®
                results.innerHTML += '<h4>åŸå§‹æ•°æ®ï¼š</h4>';
                results.innerHTML += `<textarea readonly>${data || 'æ— æ•°æ®'}</textarea>`;
                
            } catch (error) {
                results.innerHTML += `<div class="recovery-result fail">âŒ æ£€æŸ¥å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function backupData() {
            const results = document.getElementById('backup-results');
            results.innerHTML = '<h3>æ•°æ®å¤‡ä»½ï¼š</h3>';
            
            try {
                const backup = exportData();
                results.innerHTML += '<div class="recovery-result pass">âœ… å¤‡ä»½æˆåŠŸ</div>';
                results.innerHTML += '<h4>å¤‡ä»½æ•°æ®ï¼š</h4>';
                results.innerHTML += `<textarea readonly>${backup}</textarea>`;
                results.innerHTML += '<div class="recovery-result info">ğŸ’¡ è¯·å¤åˆ¶ä¸Šè¿°æ•°æ®å¹¶ä¿å­˜ï¼Œä»¥ä¾¿éœ€è¦æ—¶æ¢å¤</div>';
                
            } catch (error) {
                results.innerHTML += `<div class="recovery-result fail">âŒ å¤‡ä»½å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function restoreData() {
            const results = document.getElementById('restore-results');
            results.innerHTML = '<h3>æ•°æ®æ¢å¤ï¼š</h3>';
            
            try {
                const restoreData = document.getElementById('restore-data').value.trim();
                if (!restoreData) {
                    results.innerHTML += '<div class="recovery-result fail">âŒ è¯·è¾“å…¥è¦æ¢å¤çš„æ•°æ®</div>';
                    return;
                }
                
                // å…ˆå¤‡ä»½å½“å‰æ•°æ®
                const currentBackup = exportData();
                localStorage.setItem('my_ebbinghaus_backup_before_restore', currentBackup);
                results.innerHTML += '<div class="recovery-result info">ğŸ“ å·²å¤‡ä»½å½“å‰æ•°æ®</div>';
                
                // æ¢å¤æ•°æ®
                const success = importData(restoreData);
                if (success) {
                    results.innerHTML += '<div class="recovery-result pass">âœ… æ•°æ®æ¢å¤æˆåŠŸ</div>';
                    
                    // é‡æ–°åŠ è½½é¡µé¢æ•°æ®
                    const points = getAllKnowledgePoints();
                    results.innerHTML += `<div class="recovery-result info">ğŸ“Š æ¢å¤åçŸ¥è¯†ç‚¹æ•°é‡ï¼š${points.length}</div>`;
                } else {
                    results.innerHTML += '<div class="recovery-result fail">âŒ æ•°æ®æ¢å¤å¤±è´¥</div>';
                }
                
            } catch (error) {
                results.innerHTML += `<div class="recovery-result fail">âŒ æ¢å¤å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function clearAllData() {
            const results = document.getElementById('clear-results');
            results.innerHTML = '<h3>æ¸…ç†æ•°æ®ï¼š</h3>';
            
            try {
                // å…ˆå¤‡ä»½
                const backup = exportData();
                localStorage.setItem('my_ebbinghaus_backup_before_clear', backup);
                
                // æ¸…ç†æ•°æ®
                localStorage.removeItem('my_ebbinghaus_knowledge_points');
                localStorage.removeItem('my_ebbinghaus_settings');
                
                results.innerHTML += '<div class="recovery-result pass">âœ… æ•°æ®æ¸…ç†å®Œæˆ</div>';
                results.innerHTML += '<div class="recovery-result info">ğŸ“ å·²å¤‡ä»½æ¸…ç†å‰çš„æ•°æ®</div>';
                
            } catch (error) {
                results.innerHTML += `<div class="recovery-result fail">âŒ æ¸…ç†å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
    </script>
</body>
</html>

