<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¼å‡ºåŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .test-result { margin: 10px 0; padding: 10px; }
        .pass { background-color: #d4edda; color: #155724; }
        .fail { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button { padding: 8px 16px; margin: 5px; }
        textarea { width: 100%; height: 300px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>å¯¼å‡ºåŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. åˆ›å»ºæµ‹è¯•æ•°æ®</h2>
        <button onclick="createTestData()">åˆ›å»ºæµ‹è¯•çŸ¥è¯†ç‚¹</button>
        <div id="create-results"></div>
    </div>
    
    <div class="test-section">
        <h2>2. æµ‹è¯•å¯¼å‡ºåŠŸèƒ½</h2>
        <button onclick="testExport()">æµ‹è¯•å¯¼å‡º</button>
        <div id="export-results"></div>
    </div>
    
    <div class="test-section">
        <h2>3. é¢„è§ˆå¯¼å‡ºå†…å®¹</h2>
        <button onclick="previewExport()">é¢„è§ˆå¯¼å‡ºå†…å®¹</button>
        <div id="preview-results"></div>
    </div>
    
    <div class="test-section">
        <h2>4. æ¸…ç†æµ‹è¯•æ•°æ®</h2>
        <button onclick="clearTestData()">æ¸…ç†æ•°æ®</button>
        <div id="cleanup-results"></div>
    </div>
    
    <script src="../src/js/ebbinghaus.js"></script>
    <script src="../src/js/storage.js"></script>
    <script>
        function createTestData() {
            const results = document.getElementById('create-results');
            results.innerHTML = '<h3>åˆ›å»ºæµ‹è¯•æ•°æ®ï¼š</h3>';
            
            try {
                // æ¸…ç†ç°æœ‰æ•°æ®
                localStorage.removeItem('my_ebbinghaus_knowledge_points');
                
                // åˆ›å»ºä¸åŒæŒæ¡ç¨‹åº¦çš„æµ‹è¯•çŸ¥è¯†ç‚¹
                const testPoints = [
                    {
                        title: 'æŒæ¡çš„çŸ¥è¯†ç‚¹',
                        content: '# è¿™æ˜¯æŒæ¡çš„çŸ¥è¯†ç‚¹\n\n**é‡ç‚¹å†…å®¹ï¼š**\n- è¦ç‚¹1\n- è¦ç‚¹2\n\n```javascript\nfunction example() {\n    return "Hello World";\n}\n```',
                        masteryLevel: 'mastered',
                        tags: ['æµ‹è¯•', 'æŒæ¡', 'é‡è¦']
                    },
                    {
                        title: 'å­¦ä¹ ä¸­çš„çŸ¥è¯†ç‚¹',
                        content: '## å­¦ä¹ ä¸­çš„å†…å®¹\n\nè¿™æ˜¯ä¸€ä¸ªæ­£åœ¨å­¦ä¹ çš„çŸ¥è¯†ç‚¹ï¼Œéœ€è¦ç»§ç»­å¤ä¹ ã€‚\n\n**æ³¨æ„äº‹é¡¹ï¼š**\n1. æ³¨æ„ç†è§£æ¦‚å¿µ\n2. å¤šåšç»ƒä¹ ',
                        masteryLevel: 'learning',
                        tags: ['æµ‹è¯•', 'å­¦ä¹ ä¸­']
                    },
                    {
                        title: 'å›°éš¾çš„çŸ¥è¯†ç‚¹',
                        content: '### å›°éš¾çš„çŸ¥è¯†ç‚¹\n\nè¿™ä¸ªçŸ¥è¯†ç‚¹æ¯”è¾ƒéš¾ï¼Œéœ€è¦é‡ç‚¹å¤ä¹ ã€‚\n\n**å­¦ä¹ ç­–ç•¥ï¼š**\n- åˆ†è§£å­¦ä¹ \n- åå¤ç»ƒä¹ \n- å¯»æ±‚å¸®åŠ©',
                        masteryLevel: 'struggling',
                        tags: ['æµ‹è¯•', 'å›°éš¾', 'é‡ç‚¹']
                    }
                ];
                
                const createdPoints = [];
                testPoints.forEach(point => {
                    const created = addKnowledgePoint(point.title, point.content, point.tags, point.masteryLevel);
                    createdPoints.push(created);
                    results.innerHTML += `<div class="test-result info">âœ… åˆ›å»ºï¼š${created.title} (${created.masteryLevel})</div>`;
                });
                
                results.innerHTML += `<div class="test-result pass">âœ… æˆåŠŸåˆ›å»º ${createdPoints.length} ä¸ªæµ‹è¯•çŸ¥è¯†ç‚¹</div>`;
                
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ åˆ›å»ºå¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function testExport() {
            const results = document.getElementById('export-results');
            results.innerHTML = '<h3>æµ‹è¯•å¯¼å‡ºåŠŸèƒ½ï¼š</h3>';
            
            try {
                const points = getAllKnowledgePoints();
                
                if (points.length === 0) {
                    results.innerHTML += '<div class="test-result fail">âŒ æ²¡æœ‰çŸ¥è¯†ç‚¹å¯ä»¥å¯¼å‡º</div>';
                    return;
                }
                
                results.innerHTML += `<div class="test-result info">ğŸ“Š çŸ¥è¯†ç‚¹æ•°é‡ï¼š${points.length}</div>`;
                
                // æ¨¡æ‹Ÿå¯¼å‡ºåŠŸèƒ½
                const markdown = generateTestMarkdown(points);
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const blob = new Blob([markdown], { type: 'text/markdown;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `test_export_${getTodayString()}.md`;
                link.textContent = 'ä¸‹è½½æµ‹è¯•å¯¼å‡ºæ–‡ä»¶';
                link.style.display = 'block';
                link.style.margin = '10px 0';
                link.style.padding = '8px 16px';
                link.style.backgroundColor = '#007bff';
                link.style.color = 'white';
                link.style.textDecoration = 'none';
                link.style.borderRadius = '4px';
                
                results.appendChild(link);
                
                results.innerHTML += '<div class="test-result pass">âœ… å¯¼å‡ºåŠŸèƒ½æµ‹è¯•æˆåŠŸ</div>';
                
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ å¯¼å‡ºæµ‹è¯•å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function previewExport() {
            const results = document.getElementById('preview-results');
            results.innerHTML = '<h3>é¢„è§ˆå¯¼å‡ºå†…å®¹ï¼š</h3>';
            
            try {
                const points = getAllKnowledgePoints();
                
                if (points.length === 0) {
                    results.innerHTML += '<div class="test-result fail">âŒ æ²¡æœ‰çŸ¥è¯†ç‚¹å¯ä»¥é¢„è§ˆ</div>';
                    return;
                }
                
                const markdown = generateTestMarkdown(points);
                
                results.innerHTML += '<h4>å¯¼å‡ºçš„Markdownå†…å®¹ï¼š</h4>';
                results.innerHTML += `<textarea readonly>${markdown}</textarea>`;
                
                results.innerHTML += '<div class="test-result pass">âœ… é¢„è§ˆç”ŸæˆæˆåŠŸ</div>';
                
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ é¢„è§ˆå¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function generateTestMarkdown(points) {
            const today = getTodayString();
            const masteryDisplayNames = {
                'mastered': 'æŒæ¡',
                'learning': 'å­¦ä¹ ä¸­', 
                'struggling': 'å›°éš¾'
            };
            
            let markdown = `# My Ebbinghaus çŸ¥è¯†ç‚¹å¯¼å‡º\n\n`;
            markdown += `**å¯¼å‡ºæ—¶é—´ï¼š** ${today}\n`;
            markdown += `**çŸ¥è¯†ç‚¹æ•°é‡ï¼š** ${points.length}\n\n`;
            markdown += `---\n\n`;
            
            // æŒ‰æŒæ¡ç¨‹åº¦åˆ†ç»„
            const groupedPoints = {
                'mastered': points.filter(p => p.masteryLevel === 'mastered'),
                'learning': points.filter(p => p.masteryLevel === 'learning'),
                'struggling': points.filter(p => p.masteryLevel === 'struggling')
            };
            
            // ç”Ÿæˆå„æŒæ¡ç¨‹åº¦çš„çŸ¥è¯†ç‚¹
            Object.keys(groupedPoints).forEach(level => {
                const levelPoints = groupedPoints[level];
                if (levelPoints.length > 0) {
                    markdown += `## ${masteryDisplayNames[level]} (${levelPoints.length}ä¸ª)\n\n`;
                    
                    levelPoints.forEach((point, index) => {
                        markdown += `### ${index + 1}. ${point.title}\n\n`;
                        
                        // åŸºæœ¬ä¿¡æ¯
                        markdown += `**æŒæ¡ç¨‹åº¦ï¼š** ${masteryDisplayNames[point.masteryLevel]}\n`;
                        markdown += `**å¤ä¹ æ¬¡æ•°ï¼š** ${point.reviewCount}\n`;
                        markdown += `**åˆ›å»ºæ—¶é—´ï¼š** ${point.createdAt}\n`;
                        if (point.lastReviewed) {
                            markdown += `**ä¸Šæ¬¡å¤ä¹ ï¼š** ${point.lastReviewed}\n`;
                        }
                        markdown += `**ä¸‹æ¬¡å¤ä¹ ï¼š** ${point.nextReview}\n`;
                        
                        // æ ‡ç­¾
                        if (point.tags && point.tags.length > 0) {
                            markdown += `**æ ‡ç­¾ï¼š** ${point.tags.join(', ')}\n`;
                        }
                        
                        markdown += `\n**å†…å®¹ï¼š**\n\n`;
                        markdown += `${point.content}\n\n`;
                        markdown += `---\n\n`;
                    });
                }
            });
            
            // æ·»åŠ ç»Ÿè®¡ä¿¡æ¯
            markdown += `## ç»Ÿè®¡ä¿¡æ¯\n\n`;
            markdown += `- **æŒæ¡ï¼š** ${groupedPoints.mastered.length} ä¸ª\n`;
            markdown += `- **å­¦ä¹ ä¸­ï¼š** ${groupedPoints.learning.length} ä¸ª\n`;
            markdown += `- **å›°éš¾ï¼š** ${groupedPoints.struggling.length} ä¸ª\n`;
            markdown += `- **æ€»è®¡ï¼š** ${points.length} ä¸ª\n\n`;
            
            // æ·»åŠ å¤ä¹ æé†’
            const todayPoints = points.filter(p => p.nextReview && p.nextReview <= today);
            if (todayPoints.length > 0) {
                markdown += `## ä»Šæ—¥å¤ä¹ æé†’\n\n`;
                markdown += `ä»Šå¤©éœ€è¦å¤ä¹ çš„çŸ¥è¯†ç‚¹ï¼š\n\n`;
                todayPoints.forEach(point => {
                    markdown += `- ${point.title} (${masteryDisplayNames[point.masteryLevel]})\n`;
                });
                markdown += `\n`;
            }
            
            markdown += `---\n\n`;
            markdown += `*æ­¤æ–‡ä»¶ç”± My Ebbinghaus v1 è‡ªåŠ¨ç”Ÿæˆ*`;
            
            return markdown;
        }
        
        function clearTestData() {
            const results = document.getElementById('cleanup-results');
            results.innerHTML = '<h3>æ¸…ç†æµ‹è¯•æ•°æ®ï¼š</h3>';
            
            try {
                localStorage.removeItem('my_ebbinghaus_knowledge_points');
                localStorage.removeItem('my_ebbinghaus_settings');
                results.innerHTML += '<div class="test-result pass">âœ… æµ‹è¯•æ•°æ®æ¸…ç†å®Œæˆ</div>';
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ æ¸…ç†å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
    </script>
</body>
</html>

