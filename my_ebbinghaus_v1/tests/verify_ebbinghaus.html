<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿éªŒè¯</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .test-result { margin: 10px 0; padding: 10px; }
        .pass { background-color: #d4edda; color: #155724; }
        .fail { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button { padding: 8px 16px; margin: 5px; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>è‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿éªŒè¯å·¥å…·</h1>
    
    <div class="test-section">
        <h2>1. ç®—æ³•åŸºç¡€æµ‹è¯•</h2>
        <button onclick="testBasicAlgorithm()">æµ‹è¯•åŸºç¡€ç®—æ³•</button>
        <div id="basic-results"></div>
    </div>
    
    <div class="test-section">
        <h2>2. å¤ä¹ é—´éš”éªŒè¯</h2>
        <button onclick="testReviewIntervals()">éªŒè¯å¤ä¹ é—´éš”</button>
        <div id="interval-results"></div>
    </div>
    
    <div class="test-section">
        <h2>3. å®é™…åœºæ™¯æ¨¡æ‹Ÿ</h2>
        <button onclick="simulateRealScenario()">æ¨¡æ‹ŸçœŸå®å¤ä¹ åœºæ™¯</button>
        <div id="scenario-results"></div>
    </div>
    
    <div class="test-section">
        <h2>4. æ—¶é—´è®¡ç®—éªŒè¯</h2>
        <button onclick="verifyTimeCalculation()">éªŒè¯æ—¶é—´è®¡ç®—</button>
        <div id="time-results"></div>
    </div>
    
    <div class="test-section">
        <h2>5. æ•°æ®æŒä¹…åŒ–æµ‹è¯•</h2>
        <button onclick="testDataPersistence()">æµ‹è¯•æ•°æ®æŒä¹…åŒ–</button>
        <div id="persistence-results"></div>
    </div>
    
    <script src="../src/js/ebbinghaus.js"></script>
    <script src="../src/js/storage.js"></script>
    <script>
        function testBasicAlgorithm() {
            const results = document.getElementById('basic-results');
            results.innerHTML = '<h3>åŸºç¡€ç®—æ³•æµ‹è¯•ï¼š</h3>';
            
            try {
                // æµ‹è¯•ä¸åŒæŒæ¡ç¨‹åº¦çš„é—´éš”
                const testCases = [
                    { level: 'struggling', lastReview: '2025-01-01', count: 0, expected: '2025-01-01' },
                    { level: 'struggling', lastReview: '2025-01-01', count: 1, expected: '2025-01-02' },
                    { level: 'learning', lastReview: '2025-01-01', count: 0, expected: '2025-01-02' },
                    { level: 'learning', lastReview: '2025-01-01', count: 1, expected: '2025-01-03' },
                    { level: 'mastered', lastReview: '2025-01-01', count: 0, expected: '2025-01-02' },
                    { level: 'mastered', lastReview: '2025-01-01', count: 1, expected: '2025-01-04' }
                ];
                
                let allPassed = true;
                testCases.forEach((testCase, index) => {
                    const result = calculateNextReviewDate(testCase.level, testCase.lastReview, testCase.count);
                    const passed = result === testCase.expected;
                    if (!passed) allPassed = false;
                    
                    results.innerHTML += `
                        <div class="test-result ${passed ? 'pass' : 'fail'}">
                            ${passed ? 'âœ…' : 'âŒ'} æµ‹è¯• ${index + 1}: ${testCase.level} (ç¬¬${testCase.count}æ¬¡å¤ä¹ )
                            <br>æœŸæœ›: ${testCase.expected}, å®é™…: ${result}
                        </div>
                    `;
                });
                
                if (allPassed) {
                    results.innerHTML += '<div class="test-result pass">âœ… æ‰€æœ‰åŸºç¡€ç®—æ³•æµ‹è¯•é€šè¿‡</div>';
                } else {
                    results.innerHTML += '<div class="test-result fail">âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥</div>';
                }
                
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ åŸºç¡€ç®—æ³•æµ‹è¯•å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function testReviewIntervals() {
            const results = document.getElementById('interval-results');
            results.innerHTML = '<h3>å¤ä¹ é—´éš”éªŒè¯ï¼š</h3>';
            
            try {
                const intervals = {
                    'struggling': [0, 1, 2, 4, 8],
                    'learning': [1, 2, 4, 8, 16],
                    'mastered': [1, 3, 7, 15, 30]
                };
                
                results.innerHTML += '<table><tr><th>æŒæ¡ç¨‹åº¦</th><th>å¤ä¹ æ¬¡æ•°</th><th>é—´éš”å¤©æ•°</th><th>è®¡ç®—ç¤ºä¾‹</th></tr>';
                
                Object.keys(intervals).forEach(level => {
                    intervals[level].forEach((days, index) => {
                        const startDate = '2025-01-01';
                        const nextDate = calculateNextReviewDate(level, startDate, index);
                        const expectedDate = new Date('2025-01-01');
                        expectedDate.setDate(expectedDate.getDate() + days);
                        const expectedStr = expectedDate.toISOString().split('T')[0];
                        
                        results.innerHTML += `
                            <tr>
                                <td>${level}</td>
                                <td>${index}</td>
                                <td>${days}</td>
                                <td>${startDate} + ${days}å¤© = ${nextDate}</td>
                            </tr>
                        `;
                    });
                });
                
                results.innerHTML += '</table>';
                results.innerHTML += '<div class="test-result pass">âœ… å¤ä¹ é—´éš”éªŒè¯å®Œæˆ</div>';
                
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ å¤ä¹ é—´éš”éªŒè¯å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function simulateRealScenario() {
            const results = document.getElementById('scenario-results');
            results.innerHTML = '<h3>çœŸå®åœºæ™¯æ¨¡æ‹Ÿï¼š</h3>';
            
            try {
                // æ¸…ç†ç°æœ‰æ•°æ®
                localStorage.removeItem('my_ebbinghaus_knowledge_points');
                
                // åˆ›å»ºæµ‹è¯•çŸ¥è¯†ç‚¹
                const testPoint = addKnowledgePoint(
                    'æµ‹è¯•çŸ¥è¯†ç‚¹',
                    'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•çŸ¥è¯†ç‚¹ï¼Œç”¨äºéªŒè¯è‰¾å®¾æµ©æ–¯æ›²çº¿',
                    ['æµ‹è¯•']
                );
                
                results.innerHTML += `<div class="test-result info">ğŸ“ åˆ›å»ºæµ‹è¯•çŸ¥è¯†ç‚¹ï¼š${testPoint.title}</div>`;
                results.innerHTML += `<div class="test-result info">ğŸ“… åˆ›å»ºæ—¶é—´ï¼š${testPoint.createdAt}</div>`;
                results.innerHTML += `<div class="test-result info">ğŸ“… ä¸‹æ¬¡å¤ä¹ ï¼š${testPoint.nextReview}</div>`;
                results.innerHTML += `<div class="test-result info">ğŸ“Š æŒæ¡ç¨‹åº¦ï¼š${testPoint.masteryLevel}</div>`;
                
                // æ¨¡æ‹Ÿå¤ä¹ è¿‡ç¨‹
                const today = getTodayString();
                results.innerHTML += `<div class="test-result info">ğŸ—“ï¸ ä»Šå¤©æ—¥æœŸï¼š${today}</div>`;
                
                // æ£€æŸ¥æ˜¯å¦éœ€è¦å¤ä¹ 
                const shouldReview = shouldReview(testPoint.nextReview);
                results.innerHTML += `<div class="test-result ${shouldReview ? 'pass' : 'info'}">
                    ${shouldReview ? 'âœ…' : 'â„¹ï¸'} ä»Šå¤©${shouldReview ? 'éœ€è¦' : 'ä¸éœ€è¦'}å¤ä¹ 
                </div>`;
                
                // æ¨¡æ‹Ÿå¤ä¹ æˆåŠŸ
                const newMasteryLevel = processReviewResult(testPoint.masteryLevel, 'success');
                const nextReviewDate = calculateNextReviewDate(newMasteryLevel, today, testPoint.reviewCount + 1);
                
                results.innerHTML += `<div class="test-result info">ğŸ“ˆ å¤ä¹ æˆåŠŸï¼Œæ–°æŒæ¡ç¨‹åº¦ï¼š${newMasteryLevel}</div>`;
                results.innerHTML += `<div class="test-result info">ğŸ“… ä¸‹æ¬¡å¤ä¹ æ—¶é—´ï¼š${nextReviewDate}</div>`;
                
                // æ›´æ–°çŸ¥è¯†ç‚¹
                updateKnowledgePoint(testPoint.id, {
                    masteryLevel: newMasteryLevel,
                    lastReviewed: today,
                    nextReview: nextReviewDate,
                    reviewCount: testPoint.reviewCount + 1
                });
                
                results.innerHTML += '<div class="test-result pass">âœ… çœŸå®åœºæ™¯æ¨¡æ‹Ÿå®Œæˆ</div>';
                
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ çœŸå®åœºæ™¯æ¨¡æ‹Ÿå¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function verifyTimeCalculation() {
            const results = document.getElementById('time-results');
            results.innerHTML = '<h3>æ—¶é—´è®¡ç®—éªŒè¯ï¼š</h3>';
            
            try {
                const testDate = '2025-01-01';
                const testCases = [
                    { level: 'struggling', count: 0, expectedDays: 0 },
                    { level: 'struggling', count: 1, expectedDays: 1 },
                    { level: 'learning', count: 0, expectedDays: 1 },
                    { level: 'learning', count: 1, expectedDays: 2 },
                    { level: 'mastered', count: 0, expectedDays: 1 },
                    { level: 'mastered', count: 1, expectedDays: 3 }
                ];
                
                results.innerHTML += '<table><tr><th>æŒæ¡ç¨‹åº¦</th><th>å¤ä¹ æ¬¡æ•°</th><th>æœŸæœ›é—´éš”</th><th>è®¡ç®—ç»“æœ</th><th>çŠ¶æ€</th></tr>';
                
                testCases.forEach(testCase => {
                    const result = calculateNextReviewDate(testCase.level, testDate, testCase.count);
                    const resultDate = new Date(result);
                    const startDate = new Date(testDate);
                    const actualDays = Math.floor((resultDate - startDate) / (1000 * 60 * 60 * 24));
                    const passed = actualDays === testCase.expectedDays;
                    
                    results.innerHTML += `
                        <tr>
                            <td>${testCase.level}</td>
                            <td>${testCase.count}</td>
                            <td>${testCase.expectedDays}å¤©</td>
                            <td>${actualDays}å¤©</td>
                            <td>${passed ? 'âœ…' : 'âŒ'}</td>
                        </tr>
                    `;
                });
                
                results.innerHTML += '</table>';
                results.innerHTML += '<div class="test-result pass">âœ… æ—¶é—´è®¡ç®—éªŒè¯å®Œæˆ</div>';
                
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ æ—¶é—´è®¡ç®—éªŒè¯å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function testDataPersistence() {
            const results = document.getElementById('persistence-results');
            results.innerHTML = '<h3>æ•°æ®æŒä¹…åŒ–æµ‹è¯•ï¼š</h3>';
            
            try {
                // æ¸…ç†æ•°æ®
                localStorage.removeItem('my_ebbinghaus_knowledge_points');
                
                // åˆ›å»ºæµ‹è¯•æ•°æ®
                const testPoint = addKnowledgePoint(
                    'æŒä¹…åŒ–æµ‹è¯•',
                    'æµ‹è¯•æ•°æ®æŒä¹…åŒ–åŠŸèƒ½',
                    ['æµ‹è¯•']
                );
                
                results.innerHTML += `<div class="test-result info">ğŸ“ åˆ›å»ºæµ‹è¯•æ•°æ®</div>`;
                
                // æ¨¡æ‹Ÿæ—¶é—´å˜åŒ–
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                const tomorrowStr = tomorrow.toISOString().split('T')[0];
                
                // æ›´æ–°ä¸ºæ˜å¤©éœ€è¦å¤ä¹ 
                updateKnowledgePoint(testPoint.id, {
                    nextReview: tomorrowStr
                });
                
                results.innerHTML += `<div class="test-result info">ğŸ“… è®¾ç½®æ˜å¤©å¤ä¹ ï¼š${tomorrowStr}</div>`;
                
                // é‡æ–°åŠ è½½æ•°æ®
                const points = getAllKnowledgePoints();
                const reloadedPoint = points.find(p => p.id === testPoint.id);
                
                if (reloadedPoint && reloadedPoint.nextReview === tomorrowStr) {
                    results.innerHTML += '<div class="test-result pass">âœ… æ•°æ®æŒä¹…åŒ–æˆåŠŸ</div>';
                } else {
                    results.innerHTML += '<div class="test-result fail">âŒ æ•°æ®æŒä¹…åŒ–å¤±è´¥</div>';
                }
                
                // æµ‹è¯•å¤ä¹ é˜Ÿåˆ—
                const pointsToReview = getPointsToReview();
                results.innerHTML += `<div class="test-result info">ğŸ“Š å½“å‰éœ€è¦å¤ä¹ çš„çŸ¥è¯†ç‚¹æ•°é‡ï¼š${pointsToReview.length}</div>`;
                
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ æ•°æ®æŒä¹…åŒ–æµ‹è¯•å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
    </script>
</body>
</html>

