<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜å¤©å¤ä¹ éªŒè¯</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .test-result { margin: 10px 0; padding: 10px; }
        .pass { background-color: #d4edda; color: #155724; }
        .fail { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button { padding: 8px 16px; margin: 5px; }
        .step { margin: 10px 0; padding: 10px; background-color: #f8f9fa; border-left: 4px solid #007bff; }
    </style>
</head>
<body>
    <h1>æ˜å¤©å¤ä¹ éªŒè¯å·¥å…·</h1>
    <p>è¿™ä¸ªå·¥å…·å¸®åŠ©ä½ éªŒè¯è‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿æ˜¯å¦æ­£ç¡®å·¥ä½œï¼Œç¡®ä¿æ˜å¤©èƒ½çœ‹åˆ°éœ€è¦å¤ä¹ çš„çŸ¥è¯†ç‚¹ã€‚</p>
    
    <div class="test-section">
        <h2>éªŒè¯æ­¥éª¤</h2>
        <div class="step">
            <h3>æ­¥éª¤1ï¼šåˆ›å»ºæµ‹è¯•çŸ¥è¯†ç‚¹</h3>
            <button onclick="createTestPoints()">åˆ›å»ºæµ‹è¯•çŸ¥è¯†ç‚¹</button>
            <div id="create-results"></div>
        </div>
        
        <div class="step">
            <h3>æ­¥éª¤2ï¼šè®¾ç½®ä¸åŒçš„å¤ä¹ æ—¶é—´</h3>
            <button onclick="setReviewTimes()">è®¾ç½®å¤ä¹ æ—¶é—´</button>
            <div id="time-results"></div>
        </div>
        
        <div class="step">
            <h3>æ­¥éª¤3ï¼šæ£€æŸ¥ä»Šå¤©çš„å¤ä¹ é˜Ÿåˆ—</h3>
            <button onclick="checkTodayReview()">æ£€æŸ¥ä»Šå¤©éœ€è¦å¤ä¹ çš„</button>
            <div id="today-results"></div>
        </div>
        
        <div class="step">
            <h3>æ­¥éª¤4ï¼šæ¨¡æ‹Ÿæ˜å¤©çš„æƒ…å†µ</h3>
            <button onclick="simulateTomorrow()">æ¨¡æ‹Ÿæ˜å¤©</button>
            <div id="tomorrow-results"></div>
        </div>
        
        <div class="step">
            <h3>æ­¥éª¤5ï¼šéªŒè¯å¤ä¹ é€»è¾‘</h3>
            <button onclick="verifyReviewLogic()">éªŒè¯å¤ä¹ é€»è¾‘</button>
            <div id="logic-results"></div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>æ¸…ç†æ•°æ®</h2>
        <button onclick="clearAllData()">æ¸…ç†æ‰€æœ‰æµ‹è¯•æ•°æ®</button>
        <div id="cleanup-results"></div>
    </div>
    
    <script src="../src/js/ebbinghaus.js"></script>
    <script src="../src/js/storage.js"></script>
    <script>
        function createTestPoints() {
            const results = document.getElementById('create-results');
            results.innerHTML = '<h4>åˆ›å»ºæµ‹è¯•çŸ¥è¯†ç‚¹ï¼š</h4>';
            
            try {
                // æ¸…ç†ç°æœ‰æ•°æ®
                localStorage.removeItem('my_ebbinghaus_knowledge_points');
                
                // åˆ›å»ºä¸åŒæŒæ¡ç¨‹åº¦çš„çŸ¥è¯†ç‚¹
                const testPoints = [
                    {
                        title: 'å›°éš¾çŸ¥è¯†ç‚¹-ä»Šå¤©å¤ä¹ ',
                        content: 'è¿™ä¸ªçŸ¥è¯†ç‚¹è®¾ç½®ä¸ºå›°éš¾ï¼Œä»Šå¤©éœ€è¦å¤ä¹ ',
                        masteryLevel: 'struggling',
                        tags: ['æµ‹è¯•', 'å›°éš¾']
                    },
                    {
                        title: 'å­¦ä¹ ä¸­çŸ¥è¯†ç‚¹-æ˜å¤©å¤ä¹ ',
                        content: 'è¿™ä¸ªçŸ¥è¯†ç‚¹è®¾ç½®ä¸ºå­¦ä¹ ä¸­ï¼Œæ˜å¤©éœ€è¦å¤ä¹ ',
                        masteryLevel: 'learning',
                        tags: ['æµ‹è¯•', 'å­¦ä¹ ä¸­']
                    },
                    {
                        title: 'æŒæ¡çŸ¥è¯†ç‚¹-åå¤©å¤ä¹ ',
                        content: 'è¿™ä¸ªçŸ¥è¯†ç‚¹è®¾ç½®ä¸ºæŒæ¡ï¼Œåå¤©éœ€è¦å¤ä¹ ',
                        masteryLevel: 'mastered',
                        tags: ['æµ‹è¯•', 'æŒæ¡']
                    }
                ];
                
                const createdPoints = [];
                testPoints.forEach(point => {
                    const created = addKnowledgePoint(point.title, point.content, point.tags);
                    createdPoints.push(created);
                    results.innerHTML += `<div class="test-result info">âœ… åˆ›å»ºï¼š${created.title} (${created.masteryLevel})</div>`;
                });
                
                results.innerHTML += `<div class="test-result pass">âœ… æˆåŠŸåˆ›å»º ${createdPoints.length} ä¸ªæµ‹è¯•çŸ¥è¯†ç‚¹</div>`;
                
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ åˆ›å»ºå¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function setReviewTimes() {
            const results = document.getElementById('time-results');
            results.innerHTML = '<h4>è®¾ç½®å¤ä¹ æ—¶é—´ï¼š</h4>';
            
            try {
                const points = getAllKnowledgePoints();
                const today = getTodayString();
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                const tomorrowStr = tomorrow.toISOString().split('T')[0];
                const dayAfterTomorrow = new Date();
                dayAfterTomorrow.setDate(dayAfterTomorrow.getDate() + 2);
                const dayAfterTomorrowStr = dayAfterTomorrow.toISOString().split('T')[0];
                
                results.innerHTML += `<div class="test-result info">ğŸ“… ä»Šå¤©ï¼š${today}</div>`;
                results.innerHTML += `<div class="test-result info">ğŸ“… æ˜å¤©ï¼š${tomorrowStr}</div>`;
                results.innerHTML += `<div class="test-result info">ğŸ“… åå¤©ï¼š${dayAfterTomorrowStr}</div>`;
                
                // è®¾ç½®ä¸åŒçš„å¤ä¹ æ—¶é—´
                points.forEach((point, index) => {
                    let nextReview;
                    if (index === 0) {
                        // ç¬¬ä¸€ä¸ªï¼šä»Šå¤©å¤ä¹ 
                        nextReview = today;
                    } else if (index === 1) {
                        // ç¬¬äºŒä¸ªï¼šæ˜å¤©å¤ä¹ 
                        nextReview = tomorrowStr;
                    } else {
                        // ç¬¬ä¸‰ä¸ªï¼šåå¤©å¤ä¹ 
                        nextReview = dayAfterTomorrowStr;
                    }
                    
                    updateKnowledgePoint(point.id, { nextReview });
                    results.innerHTML += `<div class="test-result info">ğŸ“ ${point.title} â†’ ${nextReview}</div>`;
                });
                
                results.innerHTML += '<div class="test-result pass">âœ… å¤ä¹ æ—¶é—´è®¾ç½®å®Œæˆ</div>';
                
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ è®¾ç½®å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function checkTodayReview() {
            const results = document.getElementById('today-results');
            results.innerHTML = '<h4>æ£€æŸ¥ä»Šå¤©éœ€è¦å¤ä¹ çš„çŸ¥è¯†ç‚¹ï¼š</h4>';
            
            try {
                const pointsToReview = getPointsToReview();
                const today = getTodayString();
                
                results.innerHTML += `<div class="test-result info">ğŸ“… ä»Šå¤©æ—¥æœŸï¼š${today}</div>`;
                results.innerHTML += `<div class="test-result info">ğŸ“Š éœ€è¦å¤ä¹ çš„çŸ¥è¯†ç‚¹æ•°é‡ï¼š${pointsToReview.length}</div>`;
                
                if (pointsToReview.length > 0) {
                    results.innerHTML += '<div class="test-result pass">âœ… ä»Šå¤©æœ‰éœ€è¦å¤ä¹ çš„çŸ¥è¯†ç‚¹</div>';
                    pointsToReview.forEach(point => {
                        results.innerHTML += `<div class="test-result info">ğŸ“ ${point.title} (${point.masteryLevel}) - ä¸‹æ¬¡å¤ä¹ ï¼š${point.nextReview}</div>`;
                    });
                } else {
                    results.innerHTML += '<div class="test-result info">â„¹ï¸ ä»Šå¤©æ²¡æœ‰éœ€è¦å¤ä¹ çš„çŸ¥è¯†ç‚¹</div>';
                }
                
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ æ£€æŸ¥å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function simulateTomorrow() {
            const results = document.getElementById('tomorrow-results');
            results.innerHTML = '<h4>æ¨¡æ‹Ÿæ˜å¤©çš„æƒ…å†µï¼š</h4>';
            
            try {
                const points = getAllKnowledgePoints();
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                const tomorrowStr = tomorrow.toISOString().split('T')[0];
                
                results.innerHTML += `<div class="test-result info">ğŸ“… æ¨¡æ‹Ÿæ˜å¤©ï¼š${tomorrowStr}</div>`;
                
                // æ£€æŸ¥å“ªäº›çŸ¥è¯†ç‚¹æ˜å¤©éœ€è¦å¤ä¹ 
                const tomorrowPoints = points.filter(point => {
                    return point.nextReview && point.nextReview <= tomorrowStr;
                });
                
                results.innerHTML += `<div class="test-result info">ğŸ“Š æ˜å¤©éœ€è¦å¤ä¹ çš„çŸ¥è¯†ç‚¹æ•°é‡ï¼š${tomorrowPoints.length}</div>`;
                
                if (tomorrowPoints.length > 0) {
                    results.innerHTML += '<div class="test-result pass">âœ… æ˜å¤©æœ‰éœ€è¦å¤ä¹ çš„çŸ¥è¯†ç‚¹</div>';
                    tomorrowPoints.forEach(point => {
                        results.innerHTML += `<div class="test-result info">ğŸ“ ${point.title} (${point.masteryLevel}) - ä¸‹æ¬¡å¤ä¹ ï¼š${point.nextReview}</div>`;
                    });
                } else {
                    results.innerHTML += '<div class="test-result info">â„¹ï¸ æ˜å¤©æ²¡æœ‰éœ€è¦å¤ä¹ çš„çŸ¥è¯†ç‚¹</div>';
                }
                
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ æ¨¡æ‹Ÿå¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function verifyReviewLogic() {
            const results = document.getElementById('logic-results');
            results.innerHTML = '<h4>éªŒè¯å¤ä¹ é€»è¾‘ï¼š</h4>';
            
            try {
                const points = getAllKnowledgePoints();
                const today = getTodayString();
                
                results.innerHTML += '<h5>è‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿éªŒè¯ï¼š</h5>';
                
                points.forEach(point => {
                    const shouldReviewToday = shouldReview(point.nextReview);
                    const masteryDisplay = getMasteryDisplayName(point.masteryLevel);
                    
                    results.innerHTML += `
                        <div class="test-result ${shouldReviewToday ? 'pass' : 'info'}">
                            ğŸ“ ${point.title}<br>
                            ğŸ“Š æŒæ¡ç¨‹åº¦ï¼š${masteryDisplay}<br>
                            ğŸ“… ä¸‹æ¬¡å¤ä¹ ï¼š${point.nextReview}<br>
                            ${shouldReviewToday ? 'âœ… ä»Šå¤©éœ€è¦å¤ä¹ ' : 'â„¹ï¸ ä»Šå¤©ä¸éœ€è¦å¤ä¹ '}
                        </div>
                    `;
                });
                
                // éªŒè¯å¤ä¹ é—´éš”è®¡ç®—
                results.innerHTML += '<h5>å¤ä¹ é—´éš”è®¡ç®—éªŒè¯ï¼š</h5>';
                
                const testCases = [
                    { level: 'struggling', count: 0, expectedDays: 0 },
                    { level: 'struggling', count: 1, expectedDays: 1 },
                    { level: 'learning', count: 0, expectedDays: 1 },
                    { level: 'mastered', count: 0, expectedDays: 1 }
                ];
                
                testCases.forEach(testCase => {
                    const nextReview = calculateNextReviewDate(testCase.level, today, testCase.count);
                    const nextDate = new Date(nextReview);
                    const todayDate = new Date(today);
                    const actualDays = Math.floor((nextDate - todayDate) / (1000 * 60 * 60 * 24));
                    
                    results.innerHTML += `
                        <div class="test-result ${actualDays === testCase.expectedDays ? 'pass' : 'fail'}">
                            ${actualDays === testCase.expectedDays ? 'âœ…' : 'âŒ'} 
                            ${testCase.level} (ç¬¬${testCase.count}æ¬¡) â†’ ${actualDays}å¤© (æœŸæœ›${testCase.expectedDays}å¤©)
                        </div>
                    `;
                });
                
                results.innerHTML += '<div class="test-result pass">âœ… å¤ä¹ é€»è¾‘éªŒè¯å®Œæˆ</div>';
                
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ éªŒè¯å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function clearAllData() {
            const results = document.getElementById('cleanup-results');
            results.innerHTML = '<h4>æ¸…ç†æ•°æ®ï¼š</h4>';
            
            try {
                localStorage.removeItem('my_ebbinghaus_knowledge_points');
                localStorage.removeItem('my_ebbinghaus_settings');
                results.innerHTML += '<div class="test-result pass">âœ… æ‰€æœ‰æµ‹è¯•æ•°æ®å·²æ¸…ç†</div>';
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ æ¸…ç†å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
    </script>
</body>
</html>

