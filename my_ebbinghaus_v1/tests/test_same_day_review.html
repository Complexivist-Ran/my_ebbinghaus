<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å½“å¤©å¤ä¹ æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .test-result { margin: 10px 0; padding: 10px; }
        .pass { background-color: #d4edda; color: #155724; }
        .fail { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button { padding: 8px 16px; margin: 5px; }
    </style>
</head>
<body>
    <h1>å½“å¤©å¤ä¹ åŠŸèƒ½æµ‹è¯•</h1>
    <p>æµ‹è¯•å½“å¤©å¤ä¹ å®Œåæ–°åŠ å…¥çš„çŸ¥è¯†ç‚¹æ˜¯å¦èƒ½åœ¨å½“å¤©å¤ä¹ </p>
    
    <div class="test-section">
        <h2>1. åˆ›å»ºåˆå§‹çŸ¥è¯†ç‚¹</h2>
        <button onclick="createInitialPoints()">åˆ›å»ºåˆå§‹çŸ¥è¯†ç‚¹</button>
        <div id="initial-results"></div>
    </div>
    
    <div class="test-section">
        <h2>2. æ£€æŸ¥å½“å¤©å¤ä¹ é˜Ÿåˆ—</h2>
        <button onclick="checkTodayReview()">æ£€æŸ¥å½“å¤©å¤ä¹ é˜Ÿåˆ—</button>
        <div id="today-results"></div>
    </div>
    
    <div class="test-section">
        <h2>3. æ¨¡æ‹Ÿå¤ä¹ å®Œæˆ</h2>
        <button onclick="simulateReviewComplete()">æ¨¡æ‹Ÿå¤ä¹ å®Œæˆ</button>
        <div id="review-results"></div>
    </div>
    
    <div class="test-section">
        <h2>4. æ·»åŠ æ–°çŸ¥è¯†ç‚¹</h2>
        <button onclick="addNewPoints()">æ·»åŠ æ–°çŸ¥è¯†ç‚¹</button>
        <div id="new-results"></div>
    </div>
    
    <div class="test-section">
        <h2>5. æ£€æŸ¥æ–°çŸ¥è¯†ç‚¹æ˜¯å¦åœ¨å½“å¤©å¤ä¹ é˜Ÿåˆ—</h2>
        <button onclick="checkNewPointsInQueue()">æ£€æŸ¥æ–°çŸ¥è¯†ç‚¹</button>
        <div id="queue-results"></div>
    </div>
    
    <div class="test-section">
        <h2>6. æ¸…ç†æµ‹è¯•æ•°æ®</h2>
        <button onclick="clearTestData()">æ¸…ç†æ•°æ®</button>
        <div id="cleanup-results"></div>
    </div>
    
    <script src="../src/js/ebbinghaus.js"></script>
    <script src="../src/js/storage.js"></script>
    <script>
        function createInitialPoints() {
            const results = document.getElementById('initial-results');
            results.innerHTML = '<h3>åˆ›å»ºåˆå§‹çŸ¥è¯†ç‚¹ï¼š</h3>';
            
            try {
                // æ¸…ç†ç°æœ‰æ•°æ®
                localStorage.removeItem('my_ebbinghaus_knowledge_points');
                
                // åˆ›å»ºä¸åŒæŒæ¡ç¨‹åº¦çš„çŸ¥è¯†ç‚¹
                const testPoints = [
                    {
                        title: 'åˆå§‹å›°éš¾çŸ¥è¯†ç‚¹',
                        content: 'è¿™æ˜¯ä¸€ä¸ªå›°éš¾çš„çŸ¥è¯†ç‚¹ï¼Œåº”è¯¥å½“å¤©å¤ä¹ ',
                        masteryLevel: 'struggling',
                        tags: ['æµ‹è¯•', 'å›°éš¾']
                    },
                    {
                        title: 'åˆå§‹å­¦ä¹ ä¸­çŸ¥è¯†ç‚¹',
                        content: 'è¿™æ˜¯ä¸€ä¸ªå­¦ä¹ ä¸­çš„çŸ¥è¯†ç‚¹ï¼Œåº”è¯¥æ˜å¤©å¤ä¹ ',
                        masteryLevel: 'learning',
                        tags: ['æµ‹è¯•', 'å­¦ä¹ ä¸­']
                    }
                ];
                
                const createdPoints = [];
                testPoints.forEach(point => {
                    const created = addKnowledgePoint(point.title, point.content, point.tags, point.masteryLevel);
                    createdPoints.push(created);
                    results.innerHTML += `<div class="test-result info">âœ… åˆ›å»ºï¼š${created.title} (${created.masteryLevel}) - ä¸‹æ¬¡å¤ä¹ ï¼š${created.nextReview}</div>`;
                });
                
                results.innerHTML += `<div class="test-result pass">âœ… æˆåŠŸåˆ›å»º ${createdPoints.length} ä¸ªåˆå§‹çŸ¥è¯†ç‚¹</div>`;
                
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ åˆ›å»ºå¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function checkTodayReview() {
            const results = document.getElementById('today-results');
            results.innerHTML = '<h3>æ£€æŸ¥å½“å¤©å¤ä¹ é˜Ÿåˆ—ï¼š</h3>';
            
            try {
                const pointsToReview = getPointsToReview();
                const today = getTodayString();
                
                results.innerHTML += `<div class="test-result info">ğŸ“… ä»Šå¤©æ—¥æœŸï¼š${today}</div>`;
                results.innerHTML += `<div class="test-result info">ğŸ“Š éœ€è¦å¤ä¹ çš„çŸ¥è¯†ç‚¹æ•°é‡ï¼š${pointsToReview.length}</div>`;
                
                if (pointsToReview.length > 0) {
                    results.innerHTML += '<div class="test-result pass">âœ… ä»Šå¤©æœ‰éœ€è¦å¤ä¹ çš„çŸ¥è¯†ç‚¹</div>';
                    pointsToReview.forEach(point => {
                        results.innerHTML += `<div class="test-result info">ğŸ“ ${point.title} (${point.masteryLevel}) - ä¸‹æ¬¡å¤ä¹ ï¼š${point.nextReview}</div>`;
                    });
                } else {
                    results.innerHTML += '<div class="test-result fail">âŒ ä»Šå¤©æ²¡æœ‰éœ€è¦å¤ä¹ çš„çŸ¥è¯†ç‚¹</div>';
                }
                
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ æ£€æŸ¥å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function simulateReviewComplete() {
            const results = document.getElementById('review-results');
            results.innerHTML = '<h3>æ¨¡æ‹Ÿå¤ä¹ å®Œæˆï¼š</h3>';
            
            try {
                const pointsToReview = getPointsToReview();
                
                if (pointsToReview.length === 0) {
                    results.innerHTML += '<div class="test-result fail">âŒ æ²¡æœ‰çŸ¥è¯†ç‚¹éœ€è¦å¤ä¹ </div>';
                    return;
                }
                
                // æ¨¡æ‹Ÿå¤ä¹ æ‰€æœ‰çŸ¥è¯†ç‚¹
                pointsToReview.forEach(point => {
                    const newMasteryLevel = processReviewResult(point.masteryLevel, 'success');
                    const nextReviewDate = calculateNextReviewDate(newMasteryLevel, getTodayString(), point.reviewCount + 1);
                    
                    updateKnowledgePoint(point.id, {
                        masteryLevel: newMasteryLevel,
                        lastReviewed: getTodayString(),
                        nextReview: nextReviewDate,
                        reviewCount: point.reviewCount + 1
                    });
                    
                    results.innerHTML += `<div class="test-result info">ğŸ“ å¤ä¹ å®Œæˆï¼š${point.title} â†’ ${newMasteryLevel} (ä¸‹æ¬¡å¤ä¹ ï¼š${nextReviewDate})</div>`;
                });
                
                results.innerHTML += '<div class="test-result pass">âœ… æ‰€æœ‰çŸ¥è¯†ç‚¹å¤ä¹ å®Œæˆ</div>';
                
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ å¤ä¹ å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function addNewPoints() {
            const results = document.getElementById('new-results');
            results.innerHTML = '<h3>æ·»åŠ æ–°çŸ¥è¯†ç‚¹ï¼š</h3>';
            
            try {
                // æ·»åŠ æ–°çš„å›°éš¾çŸ¥è¯†ç‚¹ï¼ˆåº”è¯¥å½“å¤©å¤ä¹ ï¼‰
                const newPoint = addKnowledgePoint(
                    'æ–°åŠ å…¥çš„å›°éš¾çŸ¥è¯†ç‚¹',
                    'è¿™æ˜¯å¤ä¹ å®Œæˆåæ–°åŠ å…¥çš„å›°éš¾çŸ¥è¯†ç‚¹ï¼Œåº”è¯¥èƒ½åœ¨å½“å¤©å¤ä¹ ',
                    ['æµ‹è¯•', 'æ–°åŠ å…¥', 'å›°éš¾'],
                    'struggling'
                );
                
                results.innerHTML += `<div class="test-result info">âœ… æ–°çŸ¥è¯†ç‚¹ï¼š${newPoint.title} (${newPoint.masteryLevel}) - ä¸‹æ¬¡å¤ä¹ ï¼š${newPoint.nextReview}</div>`;
                
                // éªŒè¯æ–°çŸ¥è¯†ç‚¹çš„å¤ä¹ æ—¶é—´
                const today = getTodayString();
                if (newPoint.nextReview === today) {
                    results.innerHTML += '<div class="test-result pass">âœ… æ–°å›°éš¾çŸ¥è¯†ç‚¹æ­£ç¡®è®¾ç½®ä¸ºå½“å¤©å¤ä¹ </div>';
                } else {
                    results.innerHTML += `<div class="test-result fail">âŒ æ–°å›°éš¾çŸ¥è¯†ç‚¹å¤ä¹ æ—¶é—´é”™è¯¯ï¼šæœŸæœ›${today}ï¼Œå®é™…${newPoint.nextReview}</div>`;
                }
                
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ æ·»åŠ å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function checkNewPointsInQueue() {
            const results = document.getElementById('queue-results');
            results.innerHTML = '<h3>æ£€æŸ¥æ–°çŸ¥è¯†ç‚¹æ˜¯å¦åœ¨å½“å¤©å¤ä¹ é˜Ÿåˆ—ï¼š</h3>';
            
            try {
                const pointsToReview = getPointsToReview();
                const today = getTodayString();
                
                results.innerHTML += `<div class="test-result info">ğŸ“… ä»Šå¤©æ—¥æœŸï¼š${today}</div>`;
                results.innerHTML += `<div class="test-result info">ğŸ“Š éœ€è¦å¤ä¹ çš„çŸ¥è¯†ç‚¹æ•°é‡ï¼š${pointsToReview.length}</div>`;
                
                if (pointsToReview.length > 0) {
                    results.innerHTML += '<div class="test-result pass">âœ… ä»Šå¤©æœ‰éœ€è¦å¤ä¹ çš„çŸ¥è¯†ç‚¹</div>';
                    
                    const newPoint = pointsToReview.find(p => p.title === 'æ–°åŠ å…¥çš„å›°éš¾çŸ¥è¯†ç‚¹');
                    if (newPoint) {
                        results.innerHTML += '<div class="test-result pass">âœ… æ–°åŠ å…¥çš„å›°éš¾çŸ¥è¯†ç‚¹åœ¨å½“å¤©å¤ä¹ é˜Ÿåˆ—ä¸­</div>';
                        results.innerHTML += `<div class="test-result info">ğŸ“ ${newPoint.title} (${newPoint.masteryLevel}) - ä¸‹æ¬¡å¤ä¹ ï¼š${newPoint.nextReview}</div>`;
                    } else {
                        results.innerHTML += '<div class="test-result fail">âŒ æ–°åŠ å…¥çš„å›°éš¾çŸ¥è¯†ç‚¹ä¸åœ¨å½“å¤©å¤ä¹ é˜Ÿåˆ—ä¸­</div>';
                    }
                    
                    pointsToReview.forEach(point => {
                        results.innerHTML += `<div class="test-result info">ğŸ“ ${point.title} (${point.masteryLevel}) - ä¸‹æ¬¡å¤ä¹ ï¼š${point.nextReview}</div>`;
                    });
                } else {
                    results.innerHTML += '<div class="test-result fail">âŒ ä»Šå¤©æ²¡æœ‰éœ€è¦å¤ä¹ çš„çŸ¥è¯†ç‚¹</div>';
                }
                
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ æ£€æŸ¥å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function clearTestData() {
            const results = document.getElementById('cleanup-results');
            results.innerHTML = '<h3>æ¸…ç†æµ‹è¯•æ•°æ®ï¼š</h3>';
            
            try {
                localStorage.removeItem('my_ebbinghaus_knowledge_points');
                localStorage.removeItem('my_ebbinghaus_settings');
                results.innerHTML += '<div class="test-result pass">âœ… æµ‹è¯•æ•°æ®æ¸…ç†å®Œæˆ</div>';
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">âŒ æ¸…ç†å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
